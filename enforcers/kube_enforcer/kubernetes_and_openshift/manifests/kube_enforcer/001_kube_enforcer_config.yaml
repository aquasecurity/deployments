apiVersion: v1
kind: ConfigMap
metadata:
  name: aqua-csp-kube-enforcer
  namespace: aqua
data:
  #Enable/Disable KB scanning on tainted nodes
  AQUA_KB_SCAN_TAINTED_NODES: "true"
  # Specify whether to enable/disable the cache by using "yes", "true", "no", "false" values.
  # Default value is "yes".
  AQUA_ENABLE_CACHE: "yes"
  # Specify cache expiration period in seconds.
  # Default value is 60
  AQUA_CACHE_EXPIRATION_PERIOD: "60"
  TLS_SERVER_CERT_FILEPATH: "/certs/aqua_ke.crt"
  TLS_SERVER_KEY_FILEPATH: "/certs/aqua_ke.key"
  ## Based on your ingress config update the name here ##
  AQUA_GATEWAY_SECURE_ADDRESS: "aqua-gateway.aqua:8443"
  AQUA_TLS_PORT: "8443"
  AQUA_LOGICAL_NAME: ""
  # Cluster display name in aqua enterprise.
  CLUSTER_NAME: "Default-cluster-name"
  # Enable KA policy scanning via Trivy-Operator
  AQUA_KAP_ADD_ALL_CONTROL: "true"
  AQUA_WATCH_CONFIG_AUDIT_REPORT: "true"
  AQUA_KB_IMAGE_NAME: "registry.aquasec.com/kube-bench:v0.11.2"
  AQUA_ME_IMAGE_NAME: "registry.aquasec.com/microenforcer:2022.4"
  AQUA_KB_ME_REGISTRY_NAME: "aqua-registry"
  AQUA_ENFORCER_DS_NAME: "aqua-agent"               #Sets Daemonset name
  AQUA_ME_GW_CERT_SECRET_NAME: ""
  AQUA_ADMISSION_CONTROL_WHEN_GW_DISCONNECTED: "false"
  AQUA_AUTO_WORKLOAD_DISCOVERY: "true"
  AQUA_AUTO_WORKLOAD_SCAN: "false" # This option is available only if "AQUA_AUTO_WORKLOAD_DISCOVERY" is true
  AQUA_AUTO_CONFIGURE_REGISTRIES: "false" # This option is available only if "AQUA_AUTO_WORKLOAD_DISCOVERY" is true
  #Enable Skipping Kube-Bench on nodes based on node labels
  # AQUA_NODE_LABELS_TO_SKIP_KB: ""  #Comma-separated node-labels for nodes on which Kube-Bench is to be skipped. key1=val1,key2=val2,...

  # Enable the below Env for mTLS between kube-enforcer and gateway
  # AQUA_PUBLIC_KEY: "/opt/aquasec/ssl/aqua_kube-enforcer.crt"
  # AQUA_PRIVATE_KEY: "/opt/aquasec/ssl/aqua_kube-enforcer.key"
  # AQUA_ROOT_CA: "/opt/aquasec/ssl/rootCA.crt"
---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: kube-enforcer-admission-hook-config
  namespace: aqua
webhooks:
  - name: imageassurance.aquasec.com
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources:
          - pods
          - deployments
          - deploymentconfigs
          - replicasets
          - replicationcontrollers
          - statefulsets
          - daemonsets
          - jobs
          - cronjobs
          - configmaps
          - services
          - roles
          - rolebindings
          - clusterroles
          - clusterrolebindings
          - customresourcedefinitions
    clientConfig:
      # Please follow instruction in document to generate new CA cert
      caBundle:
      service:
        namespace: aqua
        name: aqua-kube-enforcer
    timeoutSeconds: 2
    failurePolicy: Ignore
    admissionReviewVersions: ["v1beta1"]
    sideEffects: "None"
# Uncomment the below to ensure that the webhook executes exclusively on objects in namespaces other than kube-system,
# kube-node-lease and aqua.
#    namespaceSelector:
#      matchExpressions:
#        - key: kubernetes.io/metadata.name
#          operator: NotIn
#          values:
#            - kube-system
#            - kube-node-lease
#            - aqua
---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: kube-enforcer-me-injection-hook-config
  namespace: aqua
webhooks:
  - name: microenforcer.aquasec.com
    clientConfig:
      service:
        name: aqua-kube-enforcer
        namespace: aqua
        path: "/mutate"
      caBundle:
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["*"]
        apiVersions: ["v1"]
        resources: ["pods"]
    timeoutSeconds: 2
    failurePolicy: Ignore
    admissionReviewVersions: ["v1beta1"]
    sideEffects: "None"
# Uncomment the below to ensure that the webhook executes exclusively on objects in namespaces other than kube-system,
# kube-node-lease and aqua.
#    namespaceSelector:
#      matchExpressions:
#        - key: kubernetes.io/metadata.name
#          operator: NotIn
#          values:
#            - kube-system
#            - kube-node-lease
#            - aqua
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: aqua-kube-enforcer-sa
  namespace: aqua
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: aqua-kube-enforcer
rules:
  - apiGroups: ["*"]
    resources: ["pods", "nodes", "namespaces", "deployments", "jobs", "cronjobs", "daemonsets", "replicasets", "replicationcontrollers", "statefulsets", "clusterroles", "clusterrolebindings", "componentstatuses", "services" ]
    verbs: ["get", "list", "watch"]
  - apiGroups: [ "" ]
    resources: [ "serviceaccounts"]
    verbs: ["get","list","watch" ]
  - apiGroups:
      - apps.openshift.io
    resources:
      - deploymentconfigs
    verbs:
      - get
      - list
      - watch
  - apiGroups: ["aquasecurity.github.io"]
    resources: ["configauditreports", "clusterconfigauditreports"]
    verbs: ["get", "list", "watch"]
#### Please uncomment the below block if your platform is Openshift
#  - apiGroups: ["*"]
#    resources: ["pods","namespaces"]
#    verbs: ["create", "delete"]
#  - apiGroups: [""]
#    resources: ["pods/exec"]
#    verbs: ["create"]
#  - apiGroups: ["operator.openshift.io"]
#    resources: ["imagecontentsourcepolicies", "openshiftapiservers", "kubeapiservers"]
#    verbs: ["get", "list", "watch"]
#  - apiGroups: ["config.openshift.io"]
#    resources: ["imagedigestmirrorsets", "imagetagmirrorsets"]
#    verbs: ["get", "list", "watch"]
#  - apiGroups: [ "" ]
#    resources: ["endpoints"]
#    verbs: [ "list" ]
#  - apiGroups: [ "config.openshift.io" ]
#    resources: [ "clusteroperators" ]
#    verbs: [ "get", "list" ]
#  - apiGroups: ["security.openshift.io"]
#    resources: ["securitycontextconstraints"]
#    verbs: ["get", "list"]
#  - apiGroups: ["machineconfiguration.openshift.io"]
#    resources: ["machineconfigs", "machineconfigpools"]
#    verbs: ["get", "list"]
#  - apiGroups: [ "" ]
#    resources: [ "pods/log" ]
#    verbs: [ "get" ]
####
  - apiGroups: ["*"]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  - apiGroups:
      - "*"
    resources:
      - roles
      - rolebindings
      - clusterroles
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "*"
    resources:
      - customresourcedefinitions
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "*"
    resources:
      - secrets
    verbs:
      - get
      - list
      - watch
      # Comment the below 3 verbs if Pod-Enforcer injection is not going to be used
      - create 
      - update
      - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: aqua-kube-enforcer
  namespace: aqua
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: aqua-kube-enforcer
subjects:
  - kind: ServiceAccount
    name: aqua-kube-enforcer-sa
    namespace: aqua
---
# This role specific to kube-bench scans permissions
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: aqua-kube-enforcer
  namespace: aqua
rules:
  - apiGroups: ["*"]
    resources: ["pods/log"]
    verbs: ["get", "list", "watch"]
  - apiGroups: ["*"]
    resources: ["jobs"]
    verbs: ["create", "delete"]
  - apiGroups: ["*"]
    resources: ["pods"]
    verbs: ["create", "delete"]
  - apiGroups: ["*"]
    resources: ["leases"]
    verbs: ["get", "list", "create", "update"]
  - apiGroups: [ "*" ]
    resources: [ "secrets" ]
    verbs: ["create", "delete"]
  - apiGroups: [ "*" ]
    resources: [ "configmaps" ]
    verbs: ["update", "create"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: aqua-kube-enforcer
  namespace: aqua
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: aqua-kube-enforcer
subjects:
- kind: ServiceAccount
  name: aqua-kube-enforcer-sa
  namespace: aqua
---
###### Trivy-Operator resource yamls################
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.9.2
  creationTimestamp: null
  name: clusterconfigauditreports.aquasecurity.github.io
spec:
  group: aquasecurity.github.io
  names:
    kind: ClusterConfigAuditReport
    listKind: ClusterConfigAuditReportList
    plural: clusterconfigauditreports
    shortNames:
      - clusterconfigaudit
    singular: clusterconfigauditreport
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: The name of the config audit scanner
          jsonPath: .report.scanner.name
          name: Scanner
          type: string
        - description: The age of the report
          jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
        - description: The number of failed checks with critical severity
          jsonPath: .report.summary.criticalCount
          name: Critical
          priority: 1
          type: integer
        - description: The number of failed checks with high severity
          jsonPath: .report.summary.highCount
          name: High
          priority: 1
          type: integer
        - description: The number of failed checks with medium severity
          jsonPath: .report.summary.mediumCount
          name: Medium
          priority: 1
          type: integer
        - description: The number of failed checks with low severity
          jsonPath: .report.summary.lowCount
          name: Low
          priority: 1
          type: integer
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: ClusterConfigAuditReport is a specification for the ClusterConfigAuditReport
            resource.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
                  of an object. Servers should convert recognized schemas to the latest
                  internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
                  object represents. Servers may infer this from the endpoint the client
                  submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            report:
              properties:
                checks:
                  description: Checks provides results of conducting audit steps.
                  items:
                    description: Check provides the result of conducting a single audit
                      step.
                    properties:
                      category:
                        type: string
                      checkID:
                        type: string
                      description:
                        type: string
                      messages:
                        items:
                          type: string
                        type: array
                      remediation:
                        description: Remediation provides description or links to external
                          resources to remediate failing check.
                        type: string
                      scope:
                        description: Scope indicates the section of config that was
                          audited.
                        properties:
                          type:
                            description: Type indicates type of this scope, e.g. Container,
                              ConfigMapKey or JSONPath.
                            type: string
                          value:
                            description: Value indicates value of this scope that depends
                              on Type, e.g. container name, ConfigMap key or JSONPath
                              expression
                            type: string
                        required:
                          - type
                          - value
                        type: object
                      severity:
                        description: Severity level of a vulnerability or a configuration
                          audit check.
                        type: string
                      success:
                        type: boolean
                      title:
                        type: string
                    required:
                      - checkID
                      - severity
                      - success
                    type: object
                  type: array
                scanner:
                  description: Scanner is the spec for a scanner generating a security
                    assessment report.
                  properties:
                    name:
                      description: Name the name of the scanner.
                      type: string
                    vendor:
                      description: Vendor the name of the vendor providing the scanner.
                      type: string
                    version:
                      description: Version the version of the scanner.
                      type: string
                  required:
                    - name
                    - vendor
                    - version
                  type: object
                summary:
                  description: ConfigAuditSummary counts failed checks by severity.
                  properties:
                    criticalCount:
                      description: CriticalCount is the number of failed checks with
                        critical severity.
                      type: integer
                    highCount:
                      description: HighCount is the number of failed checks with high
                        severity.
                      type: integer
                    lowCount:
                      description: LowCount is the number of failed check with low severity.
                      type: integer
                    mediumCount:
                      description: MediumCount is the number of failed checks with medium
                        severity.
                      type: integer
                  required:
                    - criticalCount
                    - highCount
                    - lowCount
                    - mediumCount
                  type: object
                updateTimestamp:
                  format: date-time
                  type: string
              required:
                - checks
              type: object
          required:
            - report
          type: object
      served: true
      storage: true
      subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.9.2
  creationTimestamp: null
  name: clusterrbacassessmentreports.aquasecurity.github.io
spec:
  group: aquasecurity.github.io
  names:
    kind: ClusterRbacAssessmentReport
    listKind: ClusterRbacAssessmentReportList
    plural: clusterrbacassessmentreports
    shortNames:
      - clusterrbacassessmentreport
    singular: clusterrbacassessmentreport
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: The name of the rbac assessment scanner
          jsonPath: .report.scanner.name
          name: Scanner
          type: string
        - description: The age of the report
          jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
        - description: The number of failed checks with critical severity
          jsonPath: .report.summary.criticalCount
          name: Critical
          priority: 1
          type: integer
        - description: The number of failed checks with high severity
          jsonPath: .report.summary.highCount
          name: High
          priority: 1
          type: integer
        - description: The number of failed checks with medium severity
          jsonPath: .report.summary.mediumCount
          name: Medium
          priority: 1
          type: integer
        - description: The number of failed checks with low severity
          jsonPath: .report.summary.lowCount
          name: Low
          priority: 1
          type: integer
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: ClusterRbacAssessmentReport is a specification for the ClusterRbacAssessmentReport
            resource.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
                  of an object. Servers should convert recognized schemas to the latest
                  internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
                  object represents. Servers may infer this from the endpoint the client
                  submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            report:
              properties:
                checks:
                  description: Checks provides results of conducting audit steps.
                  items:
                    description: Check provides the result of conducting a single audit
                      step.
                    properties:
                      category:
                        type: string
                      checkID:
                        type: string
                      description:
                        type: string
                      messages:
                        items:
                          type: string
                        type: array
                      remediation:
                        description: Remediation provides description or links to external
                          resources to remediate failing check.
                        type: string
                      scope:
                        description: Scope indicates the section of config that was
                          audited.
                        properties:
                          type:
                            description: Type indicates type of this scope, e.g. Container,
                              ConfigMapKey or JSONPath.
                            type: string
                          value:
                            description: Value indicates value of this scope that depends
                              on Type, e.g. container name, ConfigMap key or JSONPath
                              expression
                            type: string
                        required:
                          - type
                          - value
                        type: object
                      severity:
                        description: Severity level of a vulnerability or a configuration
                          audit check.
                        type: string
                      success:
                        type: boolean
                      title:
                        type: string
                    required:
                      - checkID
                      - severity
                      - success
                    type: object
                  type: array
                scanner:
                  description: Scanner is the spec for a scanner generating a security
                    assessment report.
                  properties:
                    name:
                      description: Name the name of the scanner.
                      type: string
                    vendor:
                      description: Vendor the name of the vendor providing the scanner.
                      type: string
                    version:
                      description: Version the version of the scanner.
                      type: string
                  required:
                    - name
                    - vendor
                    - version
                  type: object
                summary:
                  description: RbacAssessmentSummary counts failed checks by severity.
                  properties:
                    criticalCount:
                      description: CriticalCount is the number of failed checks with
                        critical severity.
                      type: integer
                    highCount:
                      description: HighCount is the number of failed checks with high
                        severity.
                      type: integer
                    lowCount:
                      description: LowCount is the number of failed check with low severity.
                      type: integer
                    mediumCount:
                      description: MediumCount is the number of failed checks with medium
                        severity.
                      type: integer
                  required:
                    - criticalCount
                    - highCount
                    - lowCount
                    - mediumCount
                  type: object
              required:
                - checks
                - scanner
                - summary
              type: object
          required:
            - report
          type: object
      served: true
      storage: true
      subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.9.2
  creationTimestamp: null
  name: configauditreports.aquasecurity.github.io
spec:
  group: aquasecurity.github.io
  names:
    kind: ConfigAuditReport
    listKind: ConfigAuditReportList
    plural: configauditreports
    shortNames:
      - configaudit
      - configaudits
    singular: configauditreport
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: The name of the config audit scanner
          jsonPath: .report.scanner.name
          name: Scanner
          type: string
        - description: The age of the report
          jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
        - description: The number of failed checks with critical severity
          jsonPath: .report.summary.criticalCount
          name: Critical
          priority: 1
          type: integer
        - description: The number of failed checks with high severity
          jsonPath: .report.summary.highCount
          name: High
          priority: 1
          type: integer
        - description: The number of failed checks with medium severity
          jsonPath: .report.summary.mediumCount
          name: Medium
          priority: 1
          type: integer
        - description: The number of failed checks with low severity
          jsonPath: .report.summary.lowCount
          name: Low
          priority: 1
          type: integer
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: ConfigAuditReport is a specification for the ConfigAuditReport
            resource.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
                  of an object. Servers should convert recognized schemas to the latest
                  internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
                  object represents. Servers may infer this from the endpoint the client
                  submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            report:
              properties:
                checks:
                  description: Checks provides results of conducting audit steps.
                  items:
                    description: Check provides the result of conducting a single audit
                      step.
                    properties:
                      category:
                        type: string
                      checkID:
                        type: string
                      description:
                        type: string
                      messages:
                        items:
                          type: string
                        type: array
                      remediation:
                        description: Remediation provides description or links to external
                          resources to remediate failing check.
                        type: string
                      scope:
                        description: Scope indicates the section of config that was
                          audited.
                        properties:
                          type:
                            description: Type indicates type of this scope, e.g. Container,
                              ConfigMapKey or JSONPath.
                            type: string
                          value:
                            description: Value indicates value of this scope that depends
                              on Type, e.g. container name, ConfigMap key or JSONPath
                              expression
                            type: string
                        required:
                          - type
                          - value
                        type: object
                      severity:
                        description: Severity level of a vulnerability or a configuration
                          audit check.
                        type: string
                      success:
                        type: boolean
                      title:
                        type: string
                    required:
                      - checkID
                      - severity
                      - success
                    type: object
                  type: array
                scanner:
                  description: Scanner is the spec for a scanner generating a security
                    assessment report.
                  properties:
                    name:
                      description: Name the name of the scanner.
                      type: string
                    vendor:
                      description: Vendor the name of the vendor providing the scanner.
                      type: string
                    version:
                      description: Version the version of the scanner.
                      type: string
                  required:
                    - name
                    - vendor
                    - version
                  type: object
                summary:
                  description: ConfigAuditSummary counts failed checks by severity.
                  properties:
                    criticalCount:
                      description: CriticalCount is the number of failed checks with
                        critical severity.
                      type: integer
                    highCount:
                      description: HighCount is the number of failed checks with high
                        severity.
                      type: integer
                    lowCount:
                      description: LowCount is the number of failed check with low severity.
                      type: integer
                    mediumCount:
                      description: MediumCount is the number of failed checks with medium
                        severity.
                      type: integer
                  required:
                    - criticalCount
                    - highCount
                    - lowCount
                    - mediumCount
                  type: object
                updateTimestamp:
                  format: date-time
                  type: string
              required:
                - checks
              type: object
          required:
            - report
          type: object
      served: true
      storage: true
      subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.9.2
  creationTimestamp: null
  name: rbacassessmentreports.aquasecurity.github.io
spec:
  group: aquasecurity.github.io
  names:
    kind: RbacAssessmentReport
    listKind: RbacAssessmentReportList
    plural: rbacassessmentreports
    shortNames:
      - rbacassessment
      - rbacassessments
    singular: rbacassessmentreport
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: The name of the rbac assessment scanner
          jsonPath: .report.scanner.name
          name: Scanner
          type: string
        - description: The age of the report
          jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
        - description: The number of failed checks with critical severity
          jsonPath: .report.summary.criticalCount
          name: Critical
          priority: 1
          type: integer
        - description: The number of failed checks with high severity
          jsonPath: .report.summary.highCount
          name: High
          priority: 1
          type: integer
        - description: The number of failed checks with medium severity
          jsonPath: .report.summary.mediumCount
          name: Medium
          priority: 1
          type: integer
        - description: The number of failed checks with low severity
          jsonPath: .report.summary.lowCount
          name: Low
          priority: 1
          type: integer
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: RbacAssessmentReport is a specification for the RbacAssessmentReport
            resource.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
                  of an object. Servers should convert recognized schemas to the latest
                  internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
                  object represents. Servers may infer this from the endpoint the client
                  submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            report:
              properties:
                checks:
                  description: Checks provides results of conducting audit steps.
                  items:
                    description: Check provides the result of conducting a single audit
                      step.
                    properties:
                      category:
                        type: string
                      checkID:
                        type: string
                      description:
                        type: string
                      messages:
                        items:
                          type: string
                        type: array
                      remediation:
                        description: Remediation provides description or links to external
                          resources to remediate failing check.
                        type: string
                      scope:
                        description: Scope indicates the section of config that was
                          audited.
                        properties:
                          type:
                            description: Type indicates type of this scope, e.g. Container,
                              ConfigMapKey or JSONPath.
                            type: string
                          value:
                            description: Value indicates value of this scope that depends
                              on Type, e.g. container name, ConfigMap key or JSONPath
                              expression
                            type: string
                        required:
                          - type
                          - value
                        type: object
                      severity:
                        description: Severity level of a vulnerability or a configuration
                          audit check.
                        type: string
                      success:
                        type: boolean
                      title:
                        type: string
                    required:
                      - checkID
                      - severity
                      - success
                    type: object
                  type: array
                scanner:
                  description: Scanner is the spec for a scanner generating a security
                    assessment report.
                  properties:
                    name:
                      description: Name the name of the scanner.
                      type: string
                    vendor:
                      description: Vendor the name of the vendor providing the scanner.
                      type: string
                    version:
                      description: Version the version of the scanner.
                      type: string
                  required:
                    - name
                    - vendor
                    - version
                  type: object
                summary:
                  description: RbacAssessmentSummary counts failed checks by severity.
                  properties:
                    criticalCount:
                      description: CriticalCount is the number of failed checks with
                        critical severity.
                      type: integer
                    highCount:
                      description: HighCount is the number of failed checks with high
                        severity.
                      type: integer
                    lowCount:
                      description: LowCount is the number of failed check with low severity.
                      type: integer
                    mediumCount:
                      description: MediumCount is the number of failed checks with medium
                        severity.
                      type: integer
                  required:
                    - criticalCount
                    - highCount
                    - lowCount
                    - mediumCount
                  type: object
              required:
                - checks
                - scanner
                - summary
              type: object
          required:
            - report
          type: object
      served: true
      storage: true
      subresources: {}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: trivy-operator-trivy-config
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
data:
  trivy.repository: "ghcr.io/aquasecurity/trivy"
  trivy.tag: "0.64.1"
  trivy.additionalVulnerabilityReportFields: ""
  trivy.severity: "UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
  trivy.slow: "true"
  trivy.dbRepository: "ghcr.io/aquasecurity/trivy-db"
  trivy.command: "image"
  trivy.dbRepositoryInsecure: "false"
  trivy.useBuiltinRegoPolicies: "false"
  trivy.supportedConfigAuditKinds: "Workload,Service,Role,RoleBinding,ClusterRole,ClusterRoleBinding,NetworkPolicy,Ingress,LimitRange,ResourceQuota,ConfigMap"
  trivy.timeout: "5m0s"
  trivy.mode: "Standalone"
  trivy.resources.requests.cpu: 100m
  trivy.resources.requests.memory: 100M
  trivy.resources.limits.cpu: 500m
  trivy.resources.limits.memory: 500M
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: trivy-operator
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
data:
  scanJob.podTemplateContainerSecurityContext: "{\"allowPrivilegeEscalation\":false,\"capabilities\":{\"drop\":[\"ALL\"]},\"privileged\":false,\"readOnlyRootFilesystem\":true}"
  scanJob.compressLogs: "true"
  vulnerabilityReports.scanner: "Trivy"
  configAuditReports.scanner: "Trivy"
  report.recordFailedChecksOnly: "false"
---
apiVersion: v1
kind: Secret
metadata:
  name: trivy-operator-trivy-config
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: trivy-operator-policies-config
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: trivy-operator
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: trivy-operator
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - limitranges
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - pods
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - pods/log
    verbs:
      - get
      - list
  - apiGroups:
      - ""
    resources:
      - replicationcontrollers
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - resourcequotas
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - services
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apiextensions.k8s.io
    resources:
      - customresourcedefinitions
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps
    resources:
      - daemonsets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps
    resources:
      - deployments
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps
    resources:
      - replicasets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps
    resources:
      - statefulsets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps.openshift.io
    resources:
      - deploymentconfigs
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - aquasecurity.github.io
    resources:
      - clusterconfigauditreports
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - aquasecurity.github.io
    resources:
      - clusterrbacassessmentreports
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - aquasecurity.github.io
    resources:
      - configauditreports
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - aquasecurity.github.io
    resources:
      - rbacassessmentreports
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - batch
    resources:
      - cronjobs
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - batch
    resources:
      - jobs
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - networking.k8s.io
    resources:
      - ingresses
    verbs:
      - get
      - list
      - watch  
  - apiGroups:
      - networking.k8s.io
    resources:
      - networkpolicies
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - clusterroles
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - rolebindings
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - roles
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - serviceaccounts
    verbs:
      - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: trivy-operator
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: trivy-operator
subjects:
  - kind: ServiceAccount
    name: trivy-operator
    namespace: aqua
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: trivy-operator
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - create
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - create
      - get
      - delete
      - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: trivy-operator
  namespace: aqua
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/instance: trivy-operator
    app.kubernetes.io/version: "0.28.0"
    app.kubernetes.io/managed-by: kubectl
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: trivy-operator
subjects:
  - kind: ServiceAccount
    name: trivy-operator
    namespace: aqua
---
